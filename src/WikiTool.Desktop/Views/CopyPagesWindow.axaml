<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:WikiTool.Desktop.ViewModels"
        xmlns:converters="using:WikiTool.Desktop.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
        x:Class="WikiTool.Desktop.Views.CopyPagesWindow"
        x:DataType="vm:CopyPagesViewModel"
        Title="Copy Pages Between Wikis"
        Width="900"
        Height="700"
        MinWidth="700"
        MinHeight="500">

    <Window.Resources>
        <converters:FolderIconConverter x:Key="FolderIconConverter"/>
    </Window.Resources>

    <DockPanel>
        <!-- Top Configuration Panel -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="20"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,0,0,1">
            <StackPanel Spacing="15">
                <!-- Wiki Selection -->
                <Grid ColumnDefinitions="*,20,*" RowDefinitions="Auto,Auto">
                    <!-- Source Wiki -->
                    <StackPanel Grid.Column="0" Grid.Row="0" Spacing="5">
                        <TextBlock Text="Source Wiki"
                                   FontWeight="SemiBold"/>
                        <ComboBox ItemsSource="{Binding AvailableSourceWikis}"
                                  SelectedItem="{Binding SourceWiki}"
                                  HorizontalAlignment="Stretch">
                            <ComboBox.ItemTemplate>
                                <DataTemplate x:DataType="vm:WikiBrowserViewModel">
                                    <TextBlock Text="{Binding TabTitle}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <!-- Arrow -->
                    <TextBlock Grid.Column="1" Grid.Row="1"
                               Text="â†’"
                               FontSize="24"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>

                    <!-- Target Wiki -->
                    <StackPanel Grid.Column="2" Grid.Row="0" Spacing="5">
                        <TextBlock Text="Target Wiki"
                                   FontWeight="SemiBold"/>
                        <ComboBox ItemsSource="{Binding AvailableTargetWikis}"
                                  SelectedItem="{Binding TargetWiki}"
                                  HorizontalAlignment="Stretch">
                            <ComboBox.ItemTemplate>
                                <DataTemplate x:DataType="vm:WikiBrowserViewModel">
                                    <TextBlock Text="{Binding TabTitle}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                </Grid>

                <!-- Options -->
                <StackPanel Orientation="Horizontal" Spacing="20">
                    <CheckBox Content="Preserve folder structure"
                              IsChecked="{Binding PreserveFolderStructure}"/>
                    <CheckBox Content="Overwrite existing files"
                              IsChecked="{Binding OverwriteExisting}"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Bottom Action Bar -->
        <Border DockPanel.Dock="Bottom"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="20,15"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,1,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Status Message -->
                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"/>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="10">
                    <Button Content="Copy Selected Pages"
                            Command="{Binding CopyPagesCommand}"
                            IsEnabled="{Binding !IsProcessing}"
                            Padding="15,8"
                            Classes="accent"/>
                    <Button Content="Close"
                            Click="CloseButton_Click"
                            Padding="15,8"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Page Selection Area -->
        <Grid ColumnDefinitions="*">
            <Border Padding="20">
                <DockPanel>
                    <!-- Selection Tools -->
                    <Border DockPanel.Dock="Top"
                            Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                            Padding="10"
                            CornerRadius="4"
                            Margin="0,0,0,10">
                        <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                            <TextBlock Grid.Column="0"
                                       Text="Select Pages to Copy"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"/>

                            <StackPanel Grid.Column="2"
                                        Orientation="Horizontal"
                                        Spacing="10">
                                <Button Content="Select All"
                                        Command="{Binding SelectAllPagesCommand}"
                                        Padding="10,5"/>
                                <Button Content="Deselect All"
                                        Command="{Binding DeselectAllPagesCommand}"
                                        Padding="10,5"/>
                            </StackPanel>

                            <TextBlock Grid.Column="3"
                                       Text="{Binding SelectedPageCount, StringFormat='{}{0} selected'}"
                                       VerticalAlignment="Center"
                                       Margin="15,0,0,0"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource SystemAccentColor}"/>
                        </Grid>
                    </Border>

                    <!-- Page Tree with Checkboxes -->
                    <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                            BorderThickness="1"
                            CornerRadius="4">
                        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                      VerticalScrollBarVisibility="Auto">
                            <TreeView ItemsSource="{Binding SelectablePages}">
                                <TreeView.DataTemplates>
                                    <TreeDataTemplate DataType="vm:SelectablePageNode" ItemsSource="{Binding Children}">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <CheckBox IsChecked="{Binding IsSelected}"
                                                      VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding IsFolder, Converter={StaticResource FolderIconConverter}}"
                                                       FontSize="14"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Name}"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </TreeDataTemplate>
                                </TreeView.DataTemplates>
                            </TreeView>
                        </ScrollViewer>
                    </Border>
                </DockPanel>
            </Border>
        </Grid>
    </DockPanel>
</Window>
